<!DOCTYPE html>
<html>
<head>
  <title>Web Push FCM Demo</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-messaging-compat.js"></script>
</head>
<body>
  <button onclick="getTokenFCM()">Izinkan Notifikasi</button>
  <p id="notif-status"></p>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBLf0rYNYb5aQ22K_pDi3ombEhbgioQXnM",
      authDomain: "tugas-akhir-8ec00.firebaseapp.com",
      projectId: "tugas-akhir-8ec00",
      messagingSenderId: "557339400572",
      appId: "1:557339400572:web:22490592e955944a08acf9"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const messaging = firebase.messaging();

    async function getTokenFCM() {
      let reg = await navigator.serviceWorker.register('/firebase-messaging-sw.js');
      messaging.useServiceWorker(reg);
      try {
        let token = await messaging.getToken({ vapidKey: 'BAfmwYJamufAv5-MnCEvD5Ip_YdsAc3bcpA2gWaZTkEOhA3gVIpiuKI-SkxwUnwbwlZ1qFIj8cwIymc6oK0Iwks' });
        document.getElementById("notif-status").innerText = "Token: " + token;
        fetch('https://tes-cgrcwuat3swqbsgladyhtu.streamlit.app/add_token', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({token: token, device: 'nama_device_atau_user'})
        });
      } catch(e) {
        document.getElementById("notif-status").innerText = "Error: " + e;
      }
    }

    messaging.onMessage(function(payload) {
      alert("Push notification diterima: " + payload.notification.title + "\n" + payload.notification.body);
    });
  </script>
</body>
</html>
